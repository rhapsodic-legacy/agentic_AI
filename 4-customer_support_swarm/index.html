<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéß Customer Support Swarm</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        
        body {
            background: linear-gradient(135deg, #1e1e2f 0%, #2d2d44 50%, #1a1a2e 100%);
            min-height: 100vh;
        }
        
        /* Glass effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Agent colors */
        .agent-triage { border-left-color: #3b82f6; }
        .agent-billing { border-left-color: #10b981; }
        .agent-technical { border-left-color: #f59e0b; }
        .agent-sales { border-left-color: #8b5cf6; }
        .agent-refunds { border-left-color: #ec4899; }
        .agent-escalation { border-left-color: #ef4444; }
        .agent-retention { border-left-color: #06b6d4; }
        
        /* Chat bubbles */
        .user-bubble {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }
        
        .agent-bubble {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Handoff animation */
        @keyframes handoff {
            0% { transform: translateX(0); opacity: 1; }
            50% { transform: translateX(20px); opacity: 0; }
            51% { transform: translateX(-20px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        .handoff-animation {
            animation: handoff 0.5s ease;
        }
        
        /* Typing indicator */
        .typing-dot {
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }
            30% { opacity: 1; transform: translateY(-4px); }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const API_BASE = '';
        
        // Agent info
        const AGENTS = {
            "Triage Agent": { emoji: "üéØ", color: "blue", description: "Routes to specialists" },
            "Billing Specialist": { emoji: "üí≥", color: "green", description: "Billing & payments" },
            "Technical Support": { emoji: "üîß", color: "yellow", description: "Technical issues" },
            "Sales Agent": { emoji: "üíº", color: "purple", description: "Sales & upgrades" },
            "Refunds Specialist": { emoji: "üí∞", color: "pink", description: "Processes refunds" },
            "Escalation Agent": { emoji: "üö®", color: "red", description: "Complex issues" },
            "Retention Agent": { emoji: "ü§ù", color: "cyan", description: "Prevents cancellations" },
        };
        
        // API functions
        const api = {
            async getStatus() {
                const res = await fetch(`${API_BASE}/api/status`);
                return res.json();
            },
            
            async chat(message, customerId) {
                const res = await fetch(`${API_BASE}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, customer_id: customerId }),
                });
                return res.json();
            },
            
            async setCustomer(customerId) {
                const res = await fetch(`${API_BASE}/api/set-customer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ customer_id: customerId }),
                });
                return res.json();
            },
            
            async getCustomers() {
                const res = await fetch(`${API_BASE}/api/customers`);
                return res.json();
            },
            
            async reset() {
                const res = await fetch(`${API_BASE}/api/reset`, { method: 'POST' });
                return res.json();
            },
        };
        
        // Components
        function Header({ currentAgent, handoffCount }) {
            const agentInfo = AGENTS[currentAgent] || { emoji: "ü§ñ", color: "gray" };
            
            return (
                <header className="border-b border-white/10 py-4">
                    <div className="container mx-auto px-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <div className="text-3xl">üéß</div>
                                <div>
                                    <h1 className="text-2xl font-bold text-white">Support Swarm</h1>
                                    <p className="text-sm text-gray-400">Multi-Agent Customer Support</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center space-x-4">
                                <div className="text-right">
                                    <div className="text-sm text-gray-400">Current Agent</div>
                                    <div className="text-white font-medium">
                                        {agentInfo.emoji} {currentAgent}
                                    </div>
                                </div>
                                {handoffCount > 0 && (
                                    <div className="px-3 py-1 bg-indigo-500/20 rounded-lg text-indigo-300 text-sm">
                                        {handoffCount} handoff{handoffCount > 1 ? 's' : ''}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </header>
            );
        }
        
        function AgentSwarmDiagram({ currentAgent }) {
            const agents = [
                { name: "Triage Agent", pos: "top" },
                { name: "Billing Specialist", pos: "left" },
                { name: "Technical Support", pos: "center" },
                { name: "Sales Agent", pos: "right" },
            ];
            
            return (
                <div className="glass rounded-xl p-4">
                    <h3 className="text-sm font-medium text-gray-400 mb-3">Agent Swarm</h3>
                    <div className="space-y-2">
                        {Object.entries(AGENTS).map(([name, info]) => (
                            <div 
                                key={name}
                                className={`flex items-center space-x-2 px-3 py-2 rounded-lg transition-all ${
                                    currentAgent === name 
                                        ? 'bg-white/10 border border-white/20' 
                                        : 'opacity-50'
                                }`}
                            >
                                <span className="text-lg">{info.emoji}</span>
                                <div>
                                    <div className="text-sm text-white">{name.split(' ')[0]}</div>
                                    <div className="text-xs text-gray-500">{info.description}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        function CustomerSelector({ selectedCustomer, onSelect }) {
            const [customers, setCustomers] = useState([]);
            
            useEffect(() => {
                api.getCustomers().then(data => setCustomers(data.customers || []));
            }, []);
            
            return (
                <div className="glass rounded-xl p-4">
                    <h3 className="text-sm font-medium text-gray-400 mb-3">Customer</h3>
                    <select
                        value={selectedCustomer || ''}
                        onChange={(e) => onSelect(e.target.value)}
                        className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm"
                    >
                        <option value="">Select a customer...</option>
                        {customers.map(c => (
                            <option key={c.id} value={c.id}>
                                {c.name} ({c.id})
                            </option>
                        ))}
                    </select>
                    
                    {selectedCustomer && customers.length > 0 && (
                        <div className="mt-3 text-xs text-gray-400">
                            {customers.find(c => c.id === selectedCustomer)?.subscription_plan}
                        </div>
                    )}
                </div>
            );
        }
        
        function ChatMessage({ message, isUser, agent }) {
            const agentInfo = AGENTS[agent] || { emoji: "ü§ñ", color: "gray" };
            
            return (
                <div className={`flex ${isUser ? 'justify-end' : 'justify-start'} mb-4`}>
                    <div className={`max-w-[80%] ${isUser ? 'user-bubble' : 'agent-bubble'} rounded-2xl px-4 py-3`}>
                        {!isUser && (
                            <div className="flex items-center space-x-2 mb-2 text-sm">
                                <span>{agentInfo.emoji}</span>
                                <span className="text-gray-300 font-medium">{agent}</span>
                            </div>
                        )}
                        <div className="text-white whitespace-pre-wrap">{message}</div>
                    </div>
                </div>
            );
        }
        
        function HandoffNotification({ from, to }) {
            const fromInfo = AGENTS[from] || { emoji: "ü§ñ" };
            const toInfo = AGENTS[to] || { emoji: "ü§ñ" };
            
            return (
                <div className="flex justify-center my-4">
                    <div className="bg-indigo-500/20 border border-indigo-500/30 rounded-full px-4 py-2 text-sm text-indigo-300 flex items-center space-x-2">
                        <span>{fromInfo.emoji}</span>
                        <span>‚Üí</span>
                        <span>{toInfo.emoji}</span>
                        <span>Transferred to {to.split(' ')[0]}</span>
                    </div>
                </div>
            );
        }
        
        function TypingIndicator({ agent }) {
            const agentInfo = AGENTS[agent] || { emoji: "ü§ñ" };
            
            return (
                <div className="flex justify-start mb-4">
                    <div className="agent-bubble rounded-2xl px-4 py-3">
                        <div className="flex items-center space-x-2 text-sm text-gray-300">
                            <span>{agentInfo.emoji}</span>
                            <span>{agent} is typing</span>
                            <div className="flex space-x-1">
                                <div className="typing-dot w-2 h-2 bg-gray-400 rounded-full"></div>
                                <div className="typing-dot w-2 h-2 bg-gray-400 rounded-full"></div>
                                <div className="typing-dot w-2 h-2 bg-gray-400 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        function ChatInterface({ customerId }) {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const [currentAgent, setCurrentAgent] = useState('Triage Agent');
            const [handoffCount, setHandoffCount] = useState(0);
            const messagesEndRef = useRef(null);
            
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };
            
            useEffect(() => {
                scrollToBottom();
            }, [messages]);
            
            const examples = [
                "I was charged twice for my subscription",
                "I can't log into my account",
                "I want to upgrade to the Pro plan",
                "I need to cancel my subscription",
                "What are your pricing options?",
            ];
            
            const handleSend = async () => {
                if (!input.trim()) return;
                
                // Add user message
                setMessages(prev => [...prev, { role: 'user', content: input }]);
                setInput('');
                setLoading(true);
                
                try {
                    const result = await api.chat(input, customerId);
                    
                    // Check for handoff
                    if (result.agent !== currentAgent) {
                        setMessages(prev => [...prev, {
                            role: 'handoff',
                            from: currentAgent,
                            to: result.agent,
                        }]);
                    }
                    
                    setCurrentAgent(result.agent);
                    setHandoffCount(result.handoff_count);
                    
                    // Add agent response
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: result.response,
                        agent: result.agent,
                    }]);
                } catch (err) {
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: `Error: ${err.message}`,
                        agent: 'System',
                    }]);
                }
                
                setLoading(false);
            };
            
            const handleReset = async () => {
                await api.reset();
                setMessages([]);
                setCurrentAgent('Triage Agent');
                setHandoffCount(0);
            };
            
            return (
                <div className="glass rounded-xl flex flex-col h-[600px]">
                    {/* Header */}
                    <div className="border-b border-white/10 px-4 py-3 flex items-center justify-between">
                        <div className="flex items-center space-x-2">
                            <span className="text-lg">
                                {AGENTS[currentAgent]?.emoji || "ü§ñ"}
                            </span>
                            <span className="text-white font-medium">{currentAgent}</span>
                            {handoffCount > 0 && (
                                <span className="text-xs bg-indigo-500/30 px-2 py-0.5 rounded text-indigo-300">
                                    {handoffCount} handoff{handoffCount > 1 ? 's' : ''}
                                </span>
                            )}
                        </div>
                        <button
                            onClick={handleReset}
                            className="text-sm text-gray-400 hover:text-white"
                        >
                            Reset
                        </button>
                    </div>
                    
                    {/* Messages */}
                    <div className="flex-1 overflow-y-auto p-4">
                        {messages.length === 0 && (
                            <div className="text-center text-gray-500 py-8">
                                <div className="text-4xl mb-3">üéß</div>
                                <p>Welcome to Customer Support!</p>
                                <p className="text-sm mt-1">How can we help you today?</p>
                            </div>
                        )}
                        
                        {messages.map((msg, i) => (
                            msg.role === 'handoff' ? (
                                <HandoffNotification key={i} from={msg.from} to={msg.to} />
                            ) : (
                                <ChatMessage
                                    key={i}
                                    message={msg.content}
                                    isUser={msg.role === 'user'}
                                    agent={msg.agent}
                                />
                            )
                        ))}
                        
                        {loading && <TypingIndicator agent={currentAgent} />}
                        <div ref={messagesEndRef} />
                    </div>
                    
                    {/* Examples */}
                    {messages.length === 0 && (
                        <div className="px-4 pb-2">
                            <div className="flex flex-wrap gap-2">
                                {examples.map(ex => (
                                    <button
                                        key={ex}
                                        onClick={() => setInput(ex)}
                                        className="text-xs bg-white/10 text-gray-300 px-3 py-1.5 rounded-full hover:bg-white/20"
                                    >
                                        {ex}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}
                    
                    {/* Input */}
                    <div className="border-t border-white/10 p-4">
                        <div className="flex space-x-3">
                            <input
                                type="text"
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                                placeholder="Type your message..."
                                className="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-500"
                            />
                            <button
                                onClick={handleSend}
                                disabled={loading || !input.trim()}
                                className="bg-indigo-500 text-white px-6 py-3 rounded-lg hover:bg-indigo-600 disabled:opacity-50"
                            >
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            );
        }
        
        function App() {
            const [customerId, setCustomerId] = useState(null);
            const [status, setStatus] = useState({});
            
            useEffect(() => {
                api.getStatus().then(setStatus);
            }, []);
            
            return (
                <div className="min-h-screen">
                    <Header 
                        currentAgent={status.current_agent || 'Triage Agent'}
                        handoffCount={status.handoff_count || 0}
                    />
                    
                    <main className="container mx-auto px-4 py-6">
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            {/* Sidebar */}
                            <div className="space-y-4">
                                <CustomerSelector
                                    selectedCustomer={customerId}
                                    onSelect={setCustomerId}
                                />
                                <AgentSwarmDiagram 
                                    currentAgent={status.current_agent || 'Triage Agent'}
                                />
                            </div>
                            
                            {/* Chat */}
                            <div className="lg:col-span-3">
                                <ChatInterface customerId={customerId} />
                            </div>
                        </div>
                    </main>
                    
                    <footer className="border-t border-white/10 py-4 mt-8">
                        <div className="container mx-auto px-4 text-center text-gray-500 text-sm">
                            üéß Customer Support Swarm ‚Ä¢ OpenAI Swarm Pattern ‚Ä¢ Seamless Agent Handoffs
                        </div>
                    </footer>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
